       SUBROUTINE SAT4(PPH,PPC2,PN,PC13,PMG,PO,PTI,PNG,pig,pfe,IT)
C
      REAL  IP,KP,KPLOG,IPI,MOL,NH,NNH
        DIMENSION PPH(50),PPC2(50),
     1	PO(50),PTI(50),PMG(50),PC13(50),PN(50),
     2	PNG(50),pig(50),pfe(50),ppti(50)
        dimension elems(18)
	COMMON/FANSAT/FSTAR
      COMMON/COM8/NNH(50),TETA(50),PPE(50),PGG(50),T5L(50)
      COMMON/COMFH1/C(600,5),NELEM(5,600),NATOM(5,600),
     2 MMAX(600),PPMOL(600),APMLOG(600),MOL(600),
     3 IP(100),CCOMP(100),UIIDUI(100),P(100),FP(100),KP(100),NELEMX(50)
     4	,NIMAX,EPS,SWITER,NMETAL,NMOL
      COMMON/VAL/PPG(600,50)
	common/cor/elems,xxcor,nnmetal
      DIMENSION   TO(49)
      DIMENSION YA(525), YB(525), YC(525), YD(525),ELEMNT(100),
     2	CCLOG(100),G0(100),G1(100),NATOMM(5),NELEMM(5),
     3	XP(50,20),ELEM(99),XXCOR(50)
      DATA ELEMNT(99),ELEMNT(100)/'E-','H*'/
C
C
C*****IMPUT A
      AVO=0.602217E 24
      SPA=0.196E-01
      GRA=0.275423E 05
      AHE=0.100E 00
        IND = 1
      ECONST = 4.342945E-1
C
C*****IMPUT B
C        NMETAL    NUMBER OF ELEMENTS CONSIDERED IN CHEMICAL EQUILIBRIU
C        NIMAX     MAXIMUM NUMBER OF ITERATION IN NEWTON-RAPSON METHOD
C        EPS       IF ABS((X(I+1)-X(I))/X(I)).LE. EPS; CONVERGED
C        IF SWITER .GT. 0;   X(I+1)=0.5*(X(I+1)+X(I))
C        IF SWITER .LE. 0;   X(I+1)=X(I+1)
      READ(23,5000) NMETAL,NIMAX,EPS,SWITER
        NNMETAL=NMETAL
         PRINT 6102
	AFSTAR=ALOG10(FSTAR)
	READ(4,*)(XXCOR(I),I=1,NMETAL)
C
C*****IMPUT C
      DO 1002 I = 1,NMETAL
      READ(23,5001) ELEMXI,NELEMI,IPI,IG0,IG1,CCLOGI
        elems(i)=elemxi
	CCLOGI=CCLOGI+AFSTAR
	CCLOGI=CCLOGI+XXCOR(I)
	IF(I.EQ.1)CCLOGI=0.0
	IF(I.EQ.2)CCLOGI=-1.0
      NELEMX(I) = NELEMI
      ELEM(I) = ELEMXI
      ELEMNT(NELEMI) = ELEMXI
      IP(NELEMI) = IPI
C     UIIDUI(NELEMI) =FLOAT(IG1)*0.661/FLOAT(IG0)
      UIIDUI(NELEMI) = IG1 * 0.661 / IG0
      G0(NELEMI)=IG0
      G1(NELEMI)=IG1
      CCLOG(NELEMI) = CCLOGI
      CCOMP(NELEMI) = EXP(CCLOGI/ECONST)
         PRINT 6103,ELEMXI,NELEMI,IPI,IG0,IG1,CCLOGI
 1002 CONTINUE
	nnmetal=nmetal
C
C*****IMPUT D
      J = 0
 1010 J = J + 1
      READ(23,5011) MOL(J),(C(J,K),K=1,5),MMAX(J),((NELEMM(M),NATOMM(M))
     1	,M=1,4)
      MMAXJ = MMAX(J)
      IF(MMAXJ.EQ.0) GO TO 1014
      DO 1012 M=1,MMAXJ
      NELEM(M,J) = NELEMM(M)
      NATOM(M,J) = NATOMM(M)
 1012 CONTINUE
 1110 GO TO 1010
C     STARTING VALUE OF THE SOLUTION
 1014 NMOL = J - 1
      DO 1400 I=1,NMETAL
      NELEMI=NELEMX(I)
      P(NELEMI)=1.0E-20
 1400 CONTINUE
      P(99)=1.0E-10
C
C*****IMPUT E
      DO 1020  ITO=1,IT
 1023 THETA=TETA(ITO)
      TEM=5040.0/THETA
 1024 PG=PGG(ITO)
      PGLOG=ALOG10(PG)
      NH=NNH(ITO)
      TO(ITO)=10.**T5L(ITO)
C
      CALL DIE(TEM,PG)
      PE=P(99)
      PELOG=ALOG10(PE)
C
C     PRINT OUT OF THE RESULTS
C        PRINT 6300
C     PRINT 6091,   PGLOG, PELOG,PE, THETA, TEM, TO(ITO)
C     PRINT 6301
      DO 1303 I=1,NMETAL
      NELEMI=NELEMX(I)
      FPLOG=ALOG10(FP(NELEMI))
	XP(ITO,I) = P(NELEMI)+1.0E-30
      PLOG = ALOG10( XP(ITO,I) )
      PDFPL = PLOG - FPLOG
C     WRITE(6,6302) ELEMNT(NELEMI),NELEMI,CCLOG(NELEMI),FP(NELEMI),
C    1FPLOG,PLOG,PDFPL
      IF(MOD(I,5)) 1303,1304,1303
 1304 CONTINUE
C1304    PRINT 6305
 1303 CONTINUE
C        PRINT 6307
C     PRINT 6031, (DD(K),K=1,20)
 1231 CONTINUE
C1231 WRITE(6,6091) PGLOG,PELOG,PE,THETA,TEM, TO(ITO)
C     PUNCH 710,NH,THETA,PE
C 710 FORMAT(2X,E11.5,2X,F6.4,2X,E11.5,46X)
C        PRINT 6992
      IRL = 120
      DO 1184 I=1,NMETAL
      NELEMI=NELEMX(I)
      YA(I)  =  ELEMNT(NELEMI)
	PLOG=ALOG10(P(NELEMI)+1.0E-30)
	KPLOG=ALOG10(KP(NELEMI)+1.0E-30)
      YD(I)  =  KPLOG
      PIONL = PLOG + KPLOG - PELOG
      YB(I) = PIONL
      XLOG = PIONL - PGLOG
      YC(I)  =  XLOG
C
      IF (  I.NE.NMETAL )  GO TO 1450
       IQ = I / 120
      IR  =  NMETAL  -  IQ * 120
      IRL  =  IR / 3
      GO TO 1460
 1450 IF ( MOD(I,120) )  1184,1460,1184
C
 1460 NBL = 0
      DO 1470  K1=1,120,3
      NBL = NBL + 1
      K2 = K1 + 1
      K3 = K1 + 2
      IF ( NBL.EQ.IRL + 1)  GO TO 1480
 1475 CONTINUE
C1475 PRINT 6495, ( YA(K1), YB(K1), YC(K1), YD(K1),
C    2              YA(K2), YB(K2), YC(K2), YD(K2),
C    3              YA(K3), YB(K3), YC(K3), YD(K3) )
      IF ( MOD(NBL,5) ) 1470,1500,1470
 1500 CONTINUE
C1500    PRINT 6089
 1470 CONTINUE
      GO TO 1184
 1480 IRR  =  IR  -  IRL * 3
      IF ( IRR.EQ.0 )  GO TO 1184
      GO TO (1482,1484), IRR
 1482 CONTINUE
C1482 PRINT 6495, ( YA(K1), YB(K1), YC(K1), YD(K1) )
      GO TO 1184
 1484 CONTINUE
C1484 PRINT 6495, ( YA(K1), YB(K1), YC(K1), YD(K1),
C    2              YA(K2), YB(K2), YC(K2), YD(K2) )
 1184 CONTINUE
C
      IRL = 120
      KD =-119
      DO 1084 J=1,NMOL
         YA(J)  =  MOL(J)
      JCOUNT = JCOUNT + 1
	PMOLL=ALOG10(PPMOL(J)+1.0E-30)
         YB(J) = PMOLL
      XLOG = PMOLL - PGLOG
         YC(J)  =  XLOG
      PPG(J,ITO)  =  XLOG
          YD(J)  =  APMLOG(J)
C
      IF ( J.NE.NMOL ) GO TO 2450
       IQ = J / 120
      IR  =  NMOL    -  IQ * 120
      IRL  =  IR / 3
      GO TO 2460
 2450 IF ( MOD(J,120) )  2184,2460,2184
 2460 NBL = 0
C        PRINT 6092
      KD = KD + 120
      KF = KD + 119
      DO 2470  K1=KD,KF,3
      NBL = NBL + 1
      K2 = K1 + 1
      K3 = K1 + 2
      IF ( NBL.EQ.IRL + 1)  GO TO 2480
 2475 CONTINUE
C2475 PRINT 6496, ( YA(K1), YB(K1), YC(K1), YD(K1),
C    2              YA(K2), YB(K2), YC(K2), YD(K2),
C    3              YA(K3), YB(K3), YC(K3), YD(K3) )
      IF ( MOD(NBL,5) ) 2470,2500,2470
 2500 CONTINUE
C2500  PRINT 6089
 2470 CONTINUE
      GO TO 2184
 2480 IRR  =  IR  -  IRL * 3
      IF ( IRR.EQ.0 )  GO TO 2184
      GO TO (2482,2484), IRR
 2482 CONTINUE
C2482 PRINT 6496, ( YA(K1), YB(K1), YC(K1), YD(K1) )
      GO TO 2184
 2484 CONTINUE
C2484 PRINT 6496, ( YA(K1), YB(K1), YC(K1), YD(K1),
C    2              YA(K2), YB(K2), YC(K2), YD(K2) )
 2184 CONTINUE
 1084	CONTINUE
C     PRINT 6600
C
 1020  CONTINUE
      WRITE(6,100) (TO(ITO),ITO=1,IT)
  100 FORMAT(' TO=',5E15.5)
C
C1111  PUNCH 700,   ELEM(I),( XP(ITX,I),ITX=1,IT )
      DO 1111 I=1,4
 1111 PRINT 50, (XP(ITX,I),ITX=1,IT)
   50 FORMAT(7E11.4)
      write(40,*) IT
      DO 51 ITX=1,IT
      PPH(ITX)=XP(ITX,1)
       PPC2(ITX)=XP(ITX,3)
        write(40,300) PPC2(ITX)
       PN(ITX)=XP(ITX,4)
       PO(ITX)=XP(ITX,5)
       PC13(ITX)=XP(ITX,6)
	    PTI(ITX)=XP(ITX,15)
        ppti(ITX)=pti(itx)/pph(itx)
        write(90,300) PTI(ITX),PPTI(ITX)
        PMG(ITX)=XP(ITX,8)
	  PNG(ITX)=XP(ITX,9)
	  PIG(ITX)=XP(ITX,10)
	  pfe(ITX)=XP(ITX,16)
   51  CONTINUE
 1100  CONTINUE
  300  Format('  PPC2 SAT4 ', E11.3,2X,E11.3)
C   FORMATS
C
  700  FORMAT ( A3,7E11.4,/(7E11.4) )
  701 FORMAT(1X,A3,7E11.4,/(7E11.4))
 500  FORMAT (20I5)
  501  FORMAT (I4)
 5000 FORMAT(2I5,2F10.5,I10)
 5001 FORMAT(A2,2x,I6, F10.3,2I5,F10.5)
 5011 FORMAT(A3,5X,E11.5,4E12.5,I1,4(I2,I1) )
 5021 FORMAT (F10.3,E12.5,E12.6)
 5030 FORMAT(20A4)
C
 6031 FORMAT(1H1,20A4/)
 6091 FORMAT (/,10X,'LOG PG =',F8.4,20X,'LOG PE =',F8.4,20X,'PE =',E13.
     2	6/,10X,'TETA=',F8.4,20X,'TEMP=',F8.0,20X,'T0=',E14.6/)
 6102 FORMAT(1H0, 61H ELEMENT    ATOMIC NUMBER     I.P.        G(0)   G
     11)   LOG N/)
 6103 FORMAT(1H ,5X,A4,8X,I5,3X, F10.3,5X, 2I5,3X,F10.5)
 6300 FORMAT(1H0, 51H EQUILIBRIUM PARTIAL PRESSURES OF THE GASEOUS ATOM
     1///)
 6301 FORMAT(1H0,'ELEMENT',3X,'LOG N(E)/N(H)',4X,'P(E)',6X,'LOG P(E)',2
     1	X,'LOG P(A)',2X,'LOG P(A)/P(E)'/)
 6302 FORMAT(1H ,1X,A4,1X,I2,4X,F10.3,1X,E11.4,2F10.3,4X,F10.3)
 6305 FORMAT(1H )
 6307	FORMAT('   P(E) 8888 FICTITIUS PRESSURE OF THE
     1	NUCLEUS OF THE ELEMENT',/'P(A) **** PARTIAL PRESSURE OF THE
     2	MONOATOMIC GAS OF THE ELEMENT')
 6089 FORMAT (1H )
 6092 FORMAT (1H1,3(5X,'MOLECULE  LOG P   LOG P/PG  LOG KP  ')//)
 6495 FORMAT ( 3(8X,A4,'+',3F9.3) )
 6496 FORMAT ( 3(9X,A4,3F9.3) )
 6600 FORMAT (1H1)
 6992 FORMAT (///,3(9X,'ION   LOG P   LOG P/PG  LOG KP ')//)
      RETURN
      END
C*****DIE9
      SUBROUTINE DIE(TEM,PG)
      REAL IP,KP,MOL
      COMMON/COMFH1/C(600,5),NELEM(5,600),NATOM(5,600),
     2 MMAX(600),PPMOL(600),APMLOG(600),MOL(600),
     3 IP(100),CCOMP(100),UIIDUI(100),P(100),FP(100),KP(100),NELEMX(50)
     4	,NIMAX,EPS,SWITER,NMETAL,NMOL
      DIMENSION FX(100),DFX(100),Z(100),PREV(100),WA(50)
      ECONST = 4.342945E-1
      EPSDIE=5.0E-3
      T=5040.0/TEM
      PGLOG=ALOG10(PG)
C
C     HEH=HELIUM TO HYDROGEN RATIO BY NUMBER
      HEH=CCOMP(2)/CCOMP(1)
C
C     EVALUATION OF LOG KP(MOL)
      DO 1025 J =1,NMOL
      APLOGJ = C(J,5)
      DO 1026 K=1,4
      KM5=5-K
      APLOGJ = APLOGJ*T     + C(J,KM5)
 1026 CONTINUE
      APMLOG(J) = APLOGJ
 1025 CONTINUE
      DHH        = ((( 0.1196952E-02*T-0.2125713E-01)*T+0.1545253E+00)*
     1-0.5161452E+01)*T+0.1277356E+02
      DHH=EXP(DHH/ECONST)
C
C     EVALUATION OF THE IONIZATION CONSTANTS
      TEM25 = TEM**2*SQRT(TEM)
      DO 1060 I = 1,NMETAL
      NELEMI = NELEMX(I)
      KP(NELEMI) =UIIDUI(NELEMI)*TEM25*EXP(-IP(NELEMI)*T/ECONST)
 1060 CONTINUE
      HKP=KP(1)
      IF(T-0.6) 1084,1072,1072
C
C     PRELIMINARY VALUE OF PH AT HIGH TEMPERATURES
 1084 PPH=SQRT(HKP *(PG/(1.0+HEH)+HKP ))-HKP
      PH=PPH**2/HKP
      GO TO 1102
C
C     PRELIMINARY VALUE OF PH AT LOW TEMPERATURES
 1072 IF(PG/DHH-  0.1 ) 1073,1073,1074
 1073 PH=PG/(1.0+HEH)
      GO TO 1102
 1074 PH=0.5*(SQRT(DHH*(DHH+4.0*PG/(1.0+HEH)))-DHH)
C
C     EVALUATION OF THE FICTITIOUS PRESSURES OF HYDROGEN
C     PG=PH+PHH+2.0*PPH+HEH*(PH+2.0*PHH+PPH)
 1102 U=(1.0+2.0*HEH)/DHH
      Q=1.0+HEH
      R=(2.0+HEH)*SQRT(HKP )
      S=-1.0*PG
      X=SQRT(PH)
      ITERAT=0
 1103 F=((U*X**2+Q)*X+R)*X+S
      DF=2.0*(2.0*U*X**2+Q)*X+R
      XR=X-F/DF
      IF(ABS((X-XR)/XR)-EPSDIE) 1105,1105,1106
 1106 ITERAT=ITERAT+1
      IF(ITERAT-50) 1104,1104,1107
 1107   PRINT 6108, TEM,PG,X,XR,PH
 6108 FORMAT(1H1,20H NOT CONVERGE IN DIE///5H TEM=F9.2,5X,3HPG=E12.5,5X
     13HX1=E12.5,5X,3HX2=E12.5,5X,3HPH=E12.5/////)
      GO TO 1105
 1104 X=XR
      GO TO 1103
 1105 PH=XR**2
      PHH=PH**2/DHH
      PPH=SQRT(HKP *PH)
      FPH  =PH+2.0*PHH+PPH
C      PRINT 6109,  TEM,T,PG,FPH,PH
 6109	FORMAT(1X,'TEM=',F10.2,10X,'THETA=',F8.4
     1	,10X,'PG=',E13.5,10X,'FPH',E12.3,10X,'PH=',E12.3)
C     P(100)=PH+
      P(100)=PPH
C
C     EVALUATION OF THE FICTITIOUSPRESSURE OF EACH ELEMENT
      DO 1070 I=1,NMETAL
      NELEMI = NELEMX(I)
      FP(NELEMI) = CCOMP(NELEMI)*FPH
 1070 CONTINUE
C
C     CHECK OF INITIALIZATION
      PE=P(99)
      IF(PH-P(1)) 1402,1402,1401
 1401 DO 1403 I=1,NMETAL
      NELEMI=NELEMX(I)
      P(NELEMI)=FP(NELEMI)*EXP(-5.0*T/ECONST)
 1403 CONTINUE
      P(1)=PH
C
C     RUSSELL EQUATIONS
 1402 CONTINUE
 6003 FORMAT(1H0)
      NITER = 0
 1040 DO 1030 I =1,NMETAL
      NELEMI = NELEMX(I)
      FX(NELEMI) = -FP(NELEMI) + P(NELEMI)*(1.0 + KP(NELEMI)/PE)
      DFX(NELEMI) = 1.0 + KP(NELEMI)/PE
 1030 CONTINUE
      SPNION=0.0
      DO 1041 J=1,NMOL
      MMAXJ = MMAX(J)
      PMOLJL=-APMLOG(J)
      DO 1042 M =1,MMAXJ
      NELEMJ = NELEM(M,J)
      NATOMJ = NATOM(M,J)
      PMOLJL = PMOLJL + FLOAT(NATOMJ)*ALOG10(P(NELEMJ))
 1042 CONTINUE
      IF(PMOLJL - (PGLOG+1.0) ) 1046,1046,1047
 1047 DO 1048 M =1,MMAXJ
      NELEMJ = NELEM(M,J)
      NATOMJ = NATOM(M,J)
      P(NELEMJ)=1.0E-2*P(NELEMJ)
      PMOLJL = PMOLJL + FLOAT(NATOMJ)*(-2.0)
 1048 CONTINUE
 1046 PMOLJ = EXP(PMOLJL/ECONST)
      DO 1044 M =1,MMAXJ
      NELEMJ = NELEM(M,J)
      NATOMJ = NATOM(M,J)
      ATOMJ = FLOAT(NATOMJ)
      IF(NELEMJ.EQ.99) SPNION=SPNION + PMOLJ
      DO 1043 I=1,NMETAL
      NELEMI = NELEMX(I)
      IF(NELEMJ.EQ.NELEMI) GO TO 1045
      GO TO 1043
 1045 FX(NELEMI) = FX(NELEMI) + ATOMJ*PMOLJ
      DFX(NELEMI) = DFX(NELEMI) + ATOMJ**2*PMOLJ/P(NELEMI)
 1043 CONTINUE
 1044 CONTINUE
      PPMOL(J)= PMOLJ
 1041 CONTINUE
C
C     SOLUTION OF THE RUSSELL EQUATIONS BY NEWTON-RAPHSON METHOD
      DO 2001 I=1,NMETAL
      NELEMI=NELEMX(I)
	WA(I)=ALOG10(P(NELEMI)+1.0E-30)
 2001 CONTINUE
      IMAXP1=NMETAL+1
	WA(IMAXP1)=ALOG10(PE+1.0E-30)
      DELTA = 0.0
      DO 1050 I=1,NMETAL
      NELEMI = NELEMX(I)
      PREV(NELEMI) = P(NELEMI) - FX(NELEMI)/DFX(NELEMI)
      PREV(NELEMI) = ABS(PREV(NELEMI))
	IF(PREV(NELEMI).LT.1.0E-30)PREV(NELEMI)=1.0E-30
      Z(NELEMI) = PREV(NELEMI)/P(NELEMI)
      DELTA = DELTA + ABS(Z(NELEMI) - 1.0)
      IF(SWITER) 2500,2500,2501
 2501 P(NELEMI) = (PREV(NELEMI) + P(NELEMI) )*0.5
      GO TO 1050
 2500 P(NELEMI)=PREV(NELEMI)
 1050 CONTINUE
C     IONIZATION EQUILIBRIUM
      PEREV = 0.0
      DO 1061 I=1,NMETAL
      NELEMI = NELEMX(I)
      PEREV = PEREV + KP(NELEMI)*P(NELEMI)
 1061 CONTINUE
      PEREV=SQRT( PEREV/(1.0+SPNION/PE) )
      DELTA = DELTA + ABS((PE-PEREV)/PE)
      PE =(PEREV + PE )*0.5
      P(99)=PE
      IF(DELTA - EPS) 1051,1051,1052
 1052 NITER = NITER + 1
      IF(NITER-NIMAX)1040,1040,1054
 1054    PRINT 6055,  NIMAX
 6055 FORMAT(1H0,39H *DOES NOT CONVERGE AFTER ITERATIONS OF,I4/////)
C     ATOMIC NUMBER 99 = ELECTRON
 1051 RETURN
      END
