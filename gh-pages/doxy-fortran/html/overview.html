<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.9.1"/>
<title>PFANT: Overview</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="spectrum.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">PFANT
   &#160;<span id="projectnumber">version 15.08.27a</span>
   </div>
   <div id="projectbrief">Spectral synthesis software</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('overview.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Overview </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Installation"></a>
Installation</h1>
<p>Clone from github</p>
<div class="fragment"><div class="line">git clone https:<span class="comment">//github.com/trevisanj/pfant</span></div>
</div><!-- fragment --><p>or download <a href="https://github.com/trevisanj/pfant/archive/master.zip">this zip file</a>.</p>
<p>Henceforth, the symbol <code>"%"</code> denotes the directory created during installation.</p>
<h2><a class="anchor" id="install_path"></a>
Setting the system path</h2>
<p>Add the following directories to your system path: </p><ul>
<li>%/fortran/bin </li>
<li>%/pyfant/scripts</li>
</ul>
<p>Add the following to your PYTHONPATH variable: </p><ul>
<li>%/pyfant</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>If you run on Linux, the script %/add_paths.py can be handy.</dd></dl>
<div class="fragment"><div class="line">$ ./add_paths.py --tcsh  # <span class="keywordflow">if</span> you use the tcsh shell</div>
<div class="line">$ ./add_paths.py --bash  # <span class="keywordflow">if</span> you use the bash shell</div>
</div><!-- fragment --><h2><a class="anchor" id="required"></a>
Required software</h2>
<pre class="fragment">What                          Why?                       How to install
----------------------------------------------------------------------------------
gfortran, make                 Compile the Fortran code

python 2.7                     run the Python scripts

matplotlib (python package)    requirement for pyfant

fortranformat (python package) requirement for pyfant   pip install fortranformat
</pre><h1><a class="anchor" id="tree"></a>
Directory</h1>
<p>Here is an incomplete listing of the directory tree.</p>
<pre class="fragment">%
├── add_paths.py                 utility to update PATH and PYTHONPATH
├── data                         courtesy data
│   └── sun                      complete case for the Sun
├── fortran
│   ├── make_linux.sh            Linux script to build the executable binaries
│   ├── make_windows.bat         Windows script to build the exe binaries
│   ├── bin                      PFANT executable binaries
│   │   ├── hydro2
│   │   ├── innewmarcs
│   │   ├── nulbad
│   │   └── pfant
│   └── src                      Fortran and documentation source files
└── pyfant                       Python layer
    ├── scripts                  command-line tools
    │   ├── plot_filetoh.py      plots hydrogen lines in 3D
    │   ├── plot_mod_record.py   plots atmospheric model
    │   ├── plot_mod_records.py  plots NEWMARCS grid in 3D
    │   ├── plot_spectrum.py     plots synthetic spectra
    │   └── run_4exes.py         combo-runs innewmarcs, hydro2, pfant, nulbad
    │
    └── pyfant         package to operate PFANT using Python
</pre><h1><a class="anchor" id="datafiles"></a>
Input/output data files</h1>
<p>Here is a list of files used, and their default names. </p><pre class="fragment">Default name      | Description
------------------+-----------------------------------------------------------
*** star-specific files ***
main.dat          | main configuration file
abonds.dat        | abundances
dissoc.dat        | dissociation equilibrium data

*** "constant" data files ***
absoru2.dat       | absorbances ?doc?
atomgrade.dat     | atomic lines
moleculagrade.dat | molecular lines
partit.dat        | partition functions
hmap.dat          | hydrogen lines info (filename, lambda, na, nb, kiex, c1)
gridsmap.dat      | list of NEWMARCS grids
newnewm150.mod    | filenames listed in gridsmap.dat
newnewm100.mod    | "
newnewm050.mod    | "
newnewp000.mod    | "
newnewp025.mod    | "

*** created by innewmarcs ***
modeles.mod       | atmospheric model (binary file created by innewmarcs)

*** created by hydro2 ***
thalpha           | hydrogen lines files
thbeta            | "
thgamma           | "
thdelta           | "
thepsilon         | "

*** created by pfant ***
flux.norm         | normalized flux
flux.spec         | un-normalized flux (multiplied by 10**5)
flux.cont         | continuum flux (multiplied by 10**5)

*** created by nulbad ***
flux.norm.nulbad  | convolved flux
</pre><p>THe workflow can be summarized in the following diagram.</p>
<p>Note that the running sequence is innermarcs, hydro2, pfant, nulbad</p>
<pre class="fragment">                        +---------------------------+---------------------main.dat
  gridsmap.dat          |                           |                        |
newnewm150.mod          v                           v                        |
newnewm100.mod    +----------+                  +------+                     |
newnewm050.mod+--&gt;|innewmarcs|--&gt;modeles.mod+--&gt;|hydro2|&lt;----------+         |
newnewp000.mod    +----------+         +        +------+           |         |
newnewp025.mod                         |            |              |         |
                                       |            v              |         |
                                       |         thalpha           |         |
                                       |         thbeta        absoru2.dat   |
                                       |         thgamma       hmap.dat      |
                                       |         thdelta           |         |
                                       |         thepsilon         |         |
                                       |            |              |         |
                         abonds.dat    |            v              |         |
                         dissoc.dat    +--------&gt;+-----+           |         |
                      atomgrade.dat              |pfant|&lt;----------+         |
                  moleculagrade.dat+------------&gt;+-----+&lt;--------------------+
                         partit.dat                 |                        |
                                                    v                        |
                                                flux.norm                    |
                                                flux.spec                    |
                                                flux.cont                    |
                                                    |                        |
                                                    v                        |
                                                 +------+                    |
                                                 |nulbad|&lt;-------------------+
                                                 +------+
                                                    |
                                                    v
                                             flux.norm.nulbad
</pre><h1><a class="anchor" id="running"></a>
Running innewmarcs, hydro2, pfant, nulbad</h1>
<h2><a class="anchor" id="building"></a>
Building the binaries</h2>
<p>If you have gfortran installed, go to directory %/fortran and type</p>
<div class="fragment"><div class="line">$ ./make_linux.sh</div>
</div><!-- fragment --><p>or</p>
<div class="fragment"><div class="line">&gt; make_windows.bat</div>
</div><!-- fragment --><p>This should create four executables in the bin directory.</p>
<p>Also, individual makefiles are available for each (platform)x(executable), for example, the following will compile pfant on Linux:</p>
<div class="fragment"><div class="line">$ make -f makefile_linux_pfant</div>
</div><!-- fragment --><h2><a class="anchor" id="test_bin"></a>
Running with shipped data</h2>
<p>Now create a new directory somewhere <em>out of the "%" directory</em> and copy the whole contents of the %/data/sun</p>
<dl class="section user"><dt>Important</dt><dd>Don't run commands inside %/data/sun. This is part of the repository and should be kept clean.</dd></dl>
<p>If everything is alright so far, you should be able to successfully run the following commands:</p>
<div class="fragment"><div class="line">$ <a class="code" href="innewmarcs_8f90.html#a0c25c8798b248ce7840bb628bac71800">innewmarcs</a></div>
<div class="line">$ <a class="code" href="hydro2_8f90.html#a9ab46f4f3615280b1fa70f64a29838ca">hydro2</a> --hmap True</div>
<div class="line">$ pfant --hmap True</div>
<div class="line">$ <a class="code" href="nulbad_8f90.html#ae442e45d9d86ab1e15e85608517dd13d">nulbad</a></div>
</div><!-- fragment --><p>Looks good. For a full set of command-line options, use the "--help" option with any of the executables, for example:</p>
<div class="fragment"><div class="line">$ pfant --help</div>
<div class="line">$ <a class="code" href="innewmarcs_8f90.html#a0c25c8798b248ce7840bb628bac71800">innewmarcs</a> --help</div>
</div><!-- fragment --><h2><a class="anchor" id="cmd_plot"></a>
Command-line plotting tools</h2>
<p>Now let's compare que flux calculated by pfant with the convolved spectrum calculated by nulbad (requires <a href="http://matplotlib.org/faq/installing_faq.html">matplotlib</a>.</p>
<div class="fragment"><div class="line">$ plot_spectra.py flux.norm flux.norm.nulbad</div>
</div><!-- fragment --><p>Try these ones as well:</p>
<div class="fragment"><div class="line">$ plot_mod_record.py modeles.mod      # plots interpolated atmospheric model</div>
<div class="line">$ plot_mod_records.py newnewm050.mod  # plots NEWMARCS grid</div>
<div class="line">$ plot_filetoh.py thalpha             # plots hydrogen lines</div>
</div><!-- fragment --><h1><a class="anchor" id="more_python"></a>
Operation using Python</h1>
<p>The four executables can be run in batch using this python script</p>
<div class="fragment"><div class="line">run_4exes.py</div>
</div><!-- fragment --><p>For a list of available options, type:</p>
<div class="fragment"><div class="line">run_4exes.py --help</div>
</div><!-- fragment --><p>-x-x-x-x-x</p>
<pre class="fragment">.
.
.
  to be continued ...</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Oct 19 2015 19:42:52 for PFANT by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.9.1 </li>
  </ul>
</div>
</body>
</html>
